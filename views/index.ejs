<!DOCTYPE html>
<html>
<head>
    <title>BlockHead Manager</title>
    <!-- Bootstrap for modern styling -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    >
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <div class="container my-4">
    <h1 class="mb-4">Website Manager</h1>
    <!-- Instruction block to clearly explain how this page works -->
    <div class="alert alert-info instructions">
        <p class="mb-1"><strong>How to manage your sites:</strong></p>
        <ul class="mb-0">
            <li>Click <strong>Add New Site</strong> to register a domain and clone its repository.</li>
            <li>Use <strong>Pull Latest</strong> to update a site from its Git repository.</li>
            <li><strong>Backup</strong> downloads a zip containing the site files and nginx config.</li>
            <li><strong>View Config</strong> shows the generated nginx server block.</li>
            <li><strong>Delete</strong> only removes the entry here; it does not delete files.</li>
        </ul>
        <p class="mt-2">
            After adding a site, enable it with the helper script:
            <code>sudo ./scripts/enable_site.sh your-domain</code>.
            Replace <code>your-domain</code> with the domain you added.
        </p>
    </div>
    <a class="btn btn-success mb-3" href="/new">Add New Site</a>
    <table class="table table-bordered table-striped">
        <tr><th>Domain</th><th>Repository</th><th>Root</th><th>Actions</th></tr>
        <% sites.forEach(function(site){ %>
        <tr>
            <td><%= site.domain %></td>
            <td><%= site.repo %></td>
            <td><%= site.root %></td>
            <td>
                <form action="/update" method="post" style="display:inline">
                    <input type="hidden" name="domain" value="<%= site.domain %>" />
                    <button type="submit" class="btn btn-primary btn-sm">Pull Latest</button>
                </form>
                <form action="/backup" method="post" style="display:inline">
                    <input type="hidden" name="domain" value="<%= site.domain %>" />
                    <button type="submit" class="btn btn-secondary btn-sm">Backup</button>
                </form>
                <!-- Link to view the generated nginx config -->
                <a class="btn btn-info btn-sm" href="/config/<%= site.domain %>" target="_blank">View Config</a>
                <form action="/delete" method="post" style="display:inline" onsubmit="return confirm('Delete <%= site.domain %>?')">
                    <input type="hidden" name="domain" value="<%= site.domain %>" />
                    <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                </form>
            </td>
        </tr>
        <% }) %>
    </table>
    </div>
</body>
</html>
